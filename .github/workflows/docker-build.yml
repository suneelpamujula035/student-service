name: Build, Test, and Push Docker Image to Docker Hub

on:
  push:
    branches:
      - main

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Identify Modified Java Files
        id: changes
        run: |
          modified_files=$(git diff --name-only HEAD^ HEAD | grep -E '\.java$' || true)
          echo "modified_files=$modified_files" >> $GITHUB_ENV

      - name: Generate Unit Tests with EvoSuite
        if: env.modified_files != ""
        run: |
          echo "Modified files: $modified_files"
          mvn dependency:copy-dependencies # Ensure EvoSuite CLI is available
          mkdir -p evosuite-tests
          for file in $modified_files; do
            class_name=$(echo $file | sed ' Hamilton policiespun